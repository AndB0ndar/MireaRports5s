\section{Выполнение практической работы}

\section*{\LARGE Выполнение работы}
\addcontentsline{toc}{section}{Выполнение работы}

\section{Создание сети и настройка основных параметровустройства}
В части 1 вам предстоит настроить топологию сети
и основные параметры маршрутизаторов.

\subsection{Создайте сеть согласно топологии.}
Подключите устройства, как показано в топологии,
и подсоедините необходимые кабели.

\subsection{Выполните инициализацию и перезагрузку коммутаторов.}

\begin{verbatim}
    enable
    erase startup-config
    reload
\end{verbatim}

\subsection{Настройте базовые параметры каждого коммутатора.}

\begin{verbatim}
enable
config t
no ip domain lookup
hostname S1_BONDAR
enable secret class
service password-encryption
line console 0
password cisco
login
line vty 0 15
password cisco
login
logging synchronous
banner motd # You must be authorizeded! #
interface vlan 1
ip address 192.168.4.1 255.255.255.0  // S1
ip address 192.168.4.2 255.255.255.0  // S2
ip address 192.168.4.3 255.255.255.0  // S3
no shutdown
end
copy running-config startup-config
\end{verbatim}

\begin{image}
	\includegrph{switch0}
	\caption{Конфигурация коммутатора}
	\label{fig:switch:switch:0}
\end{image}

\begin{image}
	\includegrph{switch1}
	\caption{Конфигурация коммутатора}
	\label{fig:switch:switch:1}
\end{image}

\subsection{Проверьте связь}
Проверьте способность компьютеров обмениваться эхо-запросами.
Успешно ли выполняется эхо-запрос от коммутатора S1\_ФАМИЛИЯ на
коммутатор S2? Успешно ли выполняется эхо-запрос от коммутатора
S1\_ФАМИЛИЯ на коммутатор S3? Успешно ли выполняется эхо-запрос от
коммутатора S2 на коммутатор S3?
Выполняйте отладку до тех пор, пока ответы на все вопросы не будут положительными.

\begin{image}
	\includegrph{switch_ping}
	\caption{Проверка связи}
	\label{fig:switch:ping}
\end{image}

\section{Определение корневого моста}
Для каждого экземпляра протокола spanning-tree
(коммутируемая сеть LAN или широковещательный домен) существует коммутатор,
выделенный в качестве корневого моста. Корневой мост служит точкой привязки
для всех расчётов протокола spanning-tree,
позволяя определить избыточные пути, которые следует заблокировать.
Процесс выбора определяет, какой из коммутаторов станет корневым мостом.
Коммутатор с наименьшим значением идентификатора моста (BID)
становится корневым мостом.
Идентификатор BID состоит из значения приоритета моста,
расширенного идентификатора системы и MAC-адреса коммутатора.
Значение приоритета может находиться в диапазоне от 0 до 65535 с шагом 4096.
По умолчанию используется значение 32768.

\subsection{Отключите все порты на коммутаторах}

\begin{verbatim}
	interface range f0/1-24, g0/1-2
	shutdown
\end{verbatim}

\subsection{Настройте подключенные порты в качестве транковых}

\begin{verbatim}
	interface range f0/1-4
	switchport mode trunk
\end{verbatim}

Включите порты F0/2 и F0/4 на всех коммутаторах

\begin{verbatim}
	interface range f0/2, f0/4
	no shutdown
\end{verbatim}

\subsection{Отобразите данные протокола spanning-tree}
Введите команду show spanning-tree на всех трех коммутаторах.
Приоритет идентификатора моста рассчитывается путем сложения значений
приоритета и расширенного идентификатора системы.
Расширенным идентификатором системы всегда является номер сети VLAN@.

\begin{verbatim}
    show spanning-tree
\end{verbatim}

\begin{image}
	\includegrph{spanning-tree}
	\caption{Данные протокола spanning-tree}
	\label{fig:spanning_tree}
\end{image}

\textbf{Какой коммутатор является корневым мостом?}

S3

\textbf{Почему этот коммутатор был выбран протоколом spanning-tree
	в качестве корневого моста?}

Корневой мост был выбран потому,
что у него был самый низкий идентификатор моста
(значение приоритета + расширенный системный идентификатор (VLAN) +
MAC-адрес коммутатора).

\textbf{Какой порт отображается в качестве альтернативного
	и в настоящее время заблокирован?}

S1 - F0/2 (sts: BLK)

\textbf{Почему протокол spanning-tree выбрал этот порт
	в качестве невыделенного (заблокированного) порта?}

Алгоритм связующего дерева (STA) использует корневой мост
в качестве контрольной точки, а затем определяет,
какие порты блокировать, исходя из стоимости пути.
Если стоимость пути равна, затем сравниваются ставки.
Предпочтительны меньшие цифры.
В приведенном выше выводе связь между S1 и S2 имеет самую высокую стоимость
для корневого моста.
Стоимость пути через оба коммутатора одинакова,
поэтому STA выбрала путь через коммутатор с более низкой ставкой
и заблокировала порт (F0/4) на коммутаторе с более высокой ставкой (S1).

\section{Наблюдение за процессом выбора протоколом STPпорта,
	исходя из стоимости портов}
Алгоритм протокола spanning-tree (STA) использует корневой мост
как точку привязки, после чего определяет, какие порты будут заблокированы,
исходя из стоимости пути.
Порт с более низкой стоимостью пути является предпочтительным.
Если стоимости портов равны, процесс сравнивает BID@.
Если BID равны, для определения корневого моста используются приоритеты портов.
Наиболее низкие значения являются предпочтительными.
В части 3 вам предстоит изменить стоимость порта, чтобы определить, какой порт будет заблокирован протоколом
spanning-tree.

\subsection{Определите коммутатор с заблокированным портом}
При текущей конфигурации только один коммутатор может содержать
заблокированный протоколом STP порт.
Выполните команду show spanning-tree на обоих коммутаторах некорневого моста
и посмотрите, какой порт был заблокирован.

\begin{verbatim}
    show spanning-tree  // S1
    show spanning-tree  // S2
\end{verbatim}

\begin{image}
	\includegrph{part2}
	\caption{Данные протокола spanning-tree}
	\label{fig:2:spanning_tree}
\end{image}


\subsection{Измените стоимость порта}
Помимо заблокированного порта, единственным активным портом на этом коммутаторе является порт,
выделенный в качестве порта корневого моста.
Уменьшите стоимость этого порта корневого моста до 18, выполнив команду spanning-tree cost 18 режима конфигурации
интерфейса.


\begin{verbatim}
	config t
	interface f0/4
	spanning-tree cost 18
\end{verbatim}

\subsection{Просмотрите изменения протокола spanning-tree}
Повторно выполните команду show spanning-tree
на обоих коммутаторах некорневого моста. Обратите внимание,
что ранее заблокированный порт теперь является назначенным портом,
и протокол spanning-tree теперь блокирует порт
на другом коммутаторе некорневого моста.

\begin{verbatim}
    show spanning-tree  // S1
    show spanning-tree  // S2
\end{verbatim}

\begin{image}
	\includegrph{f6cast18}
	\caption{Данные протокола spanning-tree}
	\label{fig:f6:cast:18}
\end{image}

\textbf{Почему протокол spanning-tree заменяет ранее заблокированный порт
на назначенный порт и блокирует порт,
который был назначенным портом на другом коммутаторе?}

STP сначала проверяет стоимость пути.
Порт с более низкой стоимостью пути всегда
будет предпочтительнее порта с более высокой стоимостью пути.

\subsection{Удалите изменения стоимости порта.}

Выполните команду \texttt{no spanning-tree cost 18} режима конфигурации
интерфейса, чтобы удалить запись стоимости, созданную ранее.

\begin{verbatim}
	no spanning-tree cost 18
\end{verbatim}

Повторно выполните команду show spanning-tree, чтобы подтвердить,
что протокол STP сбросил порт на коммутаторе некорневого моста,
вернув исходные настройки порта. Протоколу STP требуется примерно 30 секунд,
чтобы завершить процесс перевода порта.

\section{Наблюдение за процессом выбора протоколом STPпорта,
	исходя из стоимости портов}
Если стоимости портов равны, процесс сравнивает BID.
Если BID равны, для определения корневого моста используются приоритеты портов.
Значение приоритета по умолчанию --- 128.
STP объединяет приоритет порта с номером порта, чтобы разорвать связи.
Наиболее низкие значения являются предпочтительными.
В части 4 вам предстоит активировать избыточные пути до каждого
из коммутаторов, чтобы просмотреть, каким образом
протокол STP выбирает порт с учетом приоритета портов.

Включите порты F0/1 и F0/3 на всех коммутаторах.

\begin{verbatim}
	config t
	interface range f0/1, f0/3
	no shutdown
	end
\end{verbatim}

\textbf{Какой порт выбран протоколом STP в качестве порта корневого моста
	на каждом коммутаторе некорневого моста?}

S1: f0/3
S2: f0/3

\textbf{Почему протокол STP выбрал эти порты в качестве портов
	корневого моста на этих коммутаторах?}

Он взял с наибольшим значением порта 128.3;
Cледовательно, STP использовал номер порта, чтобы разорвать связь.
Он выбрал порт с большим номером в качестве корневого порта
и заблокировал порт с меньшим номером,
указав избыточный путь к корневому мосту.


\section{Ответы на вопросы}

\subsection{Для чего используется резервирование в коммутируемых сетях 
	уровня 2? Опишите назначение протокола STP}

Резервирование является важной частью иерархической модели, 
предотвращающей перебои в оказании сетевых сервисов пользователям. Для 
сетей с резервированием требуется добавление физических путей, но 
необходимо также предусмотреть и логическое резервирование. Наличие 
альтернативных физических каналов для передачи данных по сети позволяет 
пользователям получить доступ к сетевым ресурсам даже в случае сбоя 
одного из каналов. Тем не менее избыточные маршруты в коммутируемой 
сети Ethernet могут привести к возникновению физических и логических 
петель 2-го уровня.\par
\textbf{Протокол связующего дерева (STP)} --- это сетевой протокол 
предотвращения петель, который обеспечивает избыточность при создании 
топологии уровня 2 без петель. IEEE 802.1D является исходным стандартом 
IEEE MAC соединения мостов для STP.

\subsection{Опишите негативные последствия наличия петель коммутации. 
	Почему такие петли не могут возникнуть на уровне 3?}

Без включения STP петли уровня 2 могут формироваться, что приводит 
к бесконечному циклу широковещательных, многоадресных и неизвестных 
одноадресных кадров. Это может привести к разрушению сети в течение 
очень короткого промежутка времени.
Неизвестные одноадресные кадры, отправленные в циклическую сеть, 
могут приводить к появлению дублирующихся кадров, поступающих на 
целевое устройство. Неизвестный одноадресный кадр с коммутатора 
формируется, когда у коммутатора нет MAC-адреса назначения в таблице 
MAC-адресов, и он должен переслать этот кадр со всех своих портов, за 
исключением входного порта.\par
Петли коммутации обычно возникают на уровне 2 (канальный 
уровень), когда коммутаторы в сети не используют алгоритмы блокирования 
портов и пакеты данных начинают бесконечно циркулировать между 
портами. На уровне 3 (сетевом уровне) используются протоколы 
маршрутизации, которые обеспечивают оптимальное направление передачи 
данных и предотвращают возникновение петель коммутации.

\subsection{Какие типы рассылок могут привести
	к возникновению петель коммутации?
	Дайте определение понятию “широковещательный шторм”}

Широковещательные.
\textbf{Петля коммутации} --- состояние в сети,
при котором происходит бесконечная пересылка фреймов между коммутаторами,
подключенными в один и тот же сегмент сети.\par
\textbf{Широковещательный шторм} в состоянии петли ---
когда компьютер PC-1 посылает фрейм с широковещательным адресом назначения.
В такой ситуации на все компьютеры сети будут бесконечно
рассылаться копии фрейма.

\subsection{Для чего был придуман алгоритм связующего дерева и в чем его суть?
	Дайте определение понятию BPDU}

\textbf{Протокол связующего дерева (STP)} --- это сетевой протокол,
реализованный для предотвращения петель.
Для сетей Ethernet протокол связующего дерева (STP)
создает логическую архитектуру, лишенную петель.\par
\textbf{Основная цель STP} --- остановить петли моста
и вызываемое ими широковещательное излучение.
BPDU (Bridge Protocol Data Unit) --- фрейм (единица данных)
протокола управления сетевыми мостами (IEEE 802.1d).

\subsection{Какие 4 этапа проходит протокол STP при построении топологии
	без петель коммутации? Какие поля содержит BID?}

Этапы протокола STP
\begin{enumerate}
	\item Выбор «корневого» (root) коммутатора.
	\item Выбор «корневого» (root) порта.
	\item Назначение «ыделенного» (designated) порта.
	\item Блокировка остальных портов в рамках алгоритма STP.
\end{enumerate}

\textbf{BID} --- идентификатор моста
(значение приоритета + расширенный системный идентификатор (VLAN)
+ MAC-адрес коммутатора).

Изначально Bridge ID состоял из двух полей:
\begin{itemize}
	\item \textbf{Приоритет} --- поле, которое позволяет административно влиять
		на выборы корневого коммутатора. Размер --- 2 байта,
	\item \textbf{MAC-адрес} --- используется как уникальный идентификатор,
		который, в случае совпадения значений приоритетов,
		позволяет выбрать корневой коммутатор.
		Так как MAC-адреса уникальны, то и Bridge ID уникален,
		так что какой-то коммутатор обязательно станет корневым.
\end{itemize}

\subsection{Что представляет из себя значение поля “приоритет моста”? Какое поле в BID будет учитываться при выборе корневого моста, если приоритет моста у всех коммутаторов одинаковый?}

\textbf{Приоритет} --- поле, которое позволяет административно влиять
на выборы корневого коммутатора. Размер — 2 байта.\par
\textbf{MAC-адрес} --- используется как уникальный идентификатор,
который, в случае совпадения значений приоритетов, позволяет выбрать корневой
коммутатор. Так как MAC-адреса уникальны, то и Bridge ID уникален,
так что какой-то коммутатор обязательно станет корневым.

\subsection{Какое значение приоритета моста является наиболее приоритетным и каков шаг для значений данного поля? Дайте определение понятию “стоимость корневого пути”}

Чтобы задать корневой мост, для BID выбранного коммутатора настраивается
минимальный приоритет. Для настройки приоритета моста используется
команда bridge priority. Значение приоритета может находиться в диапазоне
от 0 до 65 535, но шаг между значениями составляет 4 096.
Значение по умолчанию — 32 768.\par
Стоимость маршрута до корневого свича (Root Path Cost) --- это поле в BPDU,
которое используется для определения стоимости маршрута
от каждого порта коммутатора до корневого свича.

\subsection{Что представляет из себя значение поля “расширенный идентификатор 
системы”? Для чего данное поле было добавлено в BID?}

Расширенный идентификатор системы используется для определения 
экземпляра протокола STP
 
\subsection{Каким образом происходит выбор корневого порта? Какие критерии 
использует коммутатор для выбора роли порта при наличии 
нескольких путей равной стоимости к корневому мосту?}

Сначала сравниваются значения стоимости пути к корневому мосту, 
порт сменьшей стоимостьюпути выбирается корневым.\par
Если имеются 2 порта с одинаковой минимальной стоимостью пути 
к корневому мосту и порты подключены к разным соседним 
коммутаторам, то каждый порт смотрит в пришедший кадр BPDU и 
находит там значение BID (то есть BridgeID соседнего коммутатора, к 
которому подключен этот порт). Порт, для которого BIDменьше, 
становится корневым.\par
Если BridgeID равны или порты подключены к одному и тому же 
соседнему коммутатору, то каждый порт смотрит в пришедший кадр 
BPDU и находит там значение PortID (это PortID порта соседнего 
коммутатора, куда подключён данный порт). Порт, для которого 
данное значениеменьше, становится корневым.

\subsection{Каким образом происходит выбор назначенного порта? Какие 
состояния портов используются в протоколе STP?}

Порт коммутатора, который имеет кратчайший путь к корневому 
коммутатору - называется «назначенным».

\begin{itemize}
	\item Каждый сегмент (путь) имеет свой назначенный порт.
	\item Назначенные порты определяются на всех коммутаторах 
		(корневых и нет).
\end{itemize}

Если два порта имеют одинаковую стоимость, сначала учитывается 
идентификатор устройства (Bridge ID), а затем идентификатор порта (Port 
ID).\par
Все остальные порты переходят в альтернативный статус и блокируются.

\subsection{В чем особенность протокола PVST? Дайте краткую характеристику 
протоколу RSTP.}

Протокол PVST (Per-VLAN Spanning Tree Protocol) обеспечивает 
построение и использование на коммутаторе независимых процессов 
протокола STP (Spanning Tree Protocol) для каждой из 
сконфигурированных на нем виртуальных сетей. Каждый из 
магистральных портов такого коммутатора принимает, обрабатывает и 
формирует стандартные конфигурационные сообщения BPDU-C отдельно 
для каждой из VLAN, трафик которых через него передается. В результате 
обмена этими сообщениями порт может перейти в активное состояние для 
некоторых из VLAN и остаться в заблокированном состоянии для трафика 
других виртуальных сетей. Поскольку протокол PVST предполагает 
использование внешней схемы ISL для маркирования кадров, то для его 
реализации в каждой из VLAN классический протокол STP может быть 
использован в PVST без каких-либо изменений алгоритма. При этом, 
естественно, остаются неизменными форматы и алгоритмы формирования 
всех сообщений протокола STP. Основным недостатком протокола PVST 
является невозможность его применения в тех локальных сетях, где 
используются различные схемы кодирования принадлежности кадров к 
VLAN (ISL и IEEE 802.1Q).\par
Протокол RSTP (Rapid Spanning Tree Protocol) является улучшенной 
версией протокола Spanning Tree Protocol (STP), предназначенного для 
обеспечения избыточности и безопасности в сетях Ethernet. Вот краткая 
характеристика RSTP:

\begin{itemize}
	\item Быстрое восстановление: RSTP обеспечивает более быстрое 
		сходимое время, чем его предшественник STP, благодаря 
		уменьшению времени протоколирования портов и быстрому 
		переводу портов в активное состояние.
	\item Поддержка портов: RSTP включает в себя три основных типа 
		портов: корневые порты (Root Port), порты дизайнации (Designated 
		Port) и альтернативные порты (Alternate Port). Это позволяет 
		управлять трафиком в сети и обеспечивать избыточность 
		соединений.
	\item Переходные состояния: RSTP уменьшает время, требуемое для 
		переходных состояний, что позволяет сети быстрее 
		восстанавливаться после изменений в топологии сети.
	\item Обратная совместимость: RSTP совместим с протоколом STP, что 
		позволяет постепенно обновлять существующие сети без 
		необходимости полной переконфигурации.
	\item Избыточность: Протокол RSTP поддерживает избыточные 
		соединения, позволяя настройке резервных путей для случаев отказа 
		основных соединений.
	\item Улучшенная безопасность: RSTP включает в себя механизмы 
		защиты от циклов и петель, что повышает безопасность и 
		стабильность сети.
\end{itemize}

В целом, RSTP является эффективным протоколом для управления 
топологией сети Ethernet, обеспечивая быстрое восстановление и 
избыточность в случае сбоев или изменений в сетевой структуре.

\subsection{Охарактеризуйте состояния, в которых может находиться порт при 
	использовании протокола RSTP. Для чего нужно использовать
	функцию PortFast и для каких портов коммутатора?}

Порты в протоколе RSTP могут находиться в различных состояниях в 
зависимости от их роли и текущей сетевой топологии. Вот основные 
состояния портов в RSTP:

\begin{itemize}
	\item Discarding (Отбрасывание): Порт находится в этом состоянии, когда 
		он не участвует в пересылке данных. Он прослушивает BPDU 
		(Bridge Protocol Data Unit) для определения топологии сети и может 
		перейти в состояние forwarding или blocking в зависимости от 
		информации, полученной от других коммутаторов.
	\item Learning (Обучение): Порт находится в этом состоянии, когда он 
		начинает изучать MAC-адреса, проходящие через него. В этом 
		состоянии порт продолжает прослушивать трафик, но еще не 
		пересылает его.
	\item Forwarding (Пересылка): Порт находится в активном состоянии и 
		пересылает трафик между сегментами сети.
\end{itemize}

Функция PortFast используется для ускорения включения портов в 
состояние forwarding, обеспечивая моментальное переход из состояния 
отключения (disabled) в состояние forwarding при включении порта. Это 
полезно для портов, подключенных к устройствам конечных 
пользователей, таким как компьютеры или IP-телефоны, где отключение 
порта на короткое время может вызвать временные проблемы с 
подключением к сети. Обычно функция PortFast применяется к портам, не 
подключенным к другим коммутаторам, чтобы избежать возможности 
образования петель в сети при быстром переходе порта в состояние 
forwarding.

\subsection{Для чего необходимо использовать функцию BPDU guard и для каких 
	портов коммутатора? Какое решение можно использовать в качестве 
	альтернативы протоколу STP?}

Функция BPDU guard необходима для защиты сети от возможных 
проблем, связанных с появлением нежелательных устройств, таких как 
коммутаторы или маршрутизаторы, подключенные к портам, 
настроенным как хостовые порты с помощью функции PortFast. Эта 
функция следит за входящими BPDU на таких портах и при их 
обнаружении мгновенно отключает порт, чтобы предотвратить возможное 
образование петель в сети.\par
BPDU guard обычно применяется к портам, которые должны быть 
хостовыми портами (например, портам, к которым подключаются 
компьютеры, принтеры или IP-телефоны), чтобы предотвратить 
подключение коммутаторов или других устройств, которые могут создать 
петлю в сети.\par
В качестве альтернативы протоколу STP (Spanning Tree Protocol) можно 
использовать протоколы, разработанные для устранения недостатков STP 
и обеспечения более эффективного использования сетевых ресурсов. 
Некоторые из таких альтернатив включают в себя:

\begin{itemize}
	\item Rapid Spanning Tree Protocol (RSTP): Улучшенная версия протокола 
		STP, которая обеспечивает более быстрое восстановление сети и 
		меньшее время сходимости.
	\item Multiple Spanning Tree Protocol (MSTP): Позволяет группировать 
		виртуальные LAN (VLAN) в единый экземпляр протокола Spanning 
		Tree, что позволяет эффективно использовать пропускную 
		способность сети.
	\item Multiple Spanning Tree Protocol (MSTP): Позволяет группировать 
		виртуальные LAN (VLAN) в единый экземпляр протокола Spanning 
		Tree, что позволяет эффективно использовать пропускную 
		способность сети. 
	\item Shortest Path Bridging (SPB): Еще один протокол, разработанный для 
		замены STP и обеспечения более быстрой и эффективной 
		сходимости сети. Он основан на механизмах маршрутизации и 
		технологии мультиплексирования.
\end{itemize}

Эти альтернативы обеспечивают более высокую производительность и 
гибкость по сравнению с традиционным STP, что делает их 
привлекательным выбором для современных сетей.

